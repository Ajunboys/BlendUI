<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>layer功能测试</title>
    <link rel="stylesheet" href="">
    <script src="../../../third_party/zepto.js"></script>
    <script src="../../../third_party/require.js"></script>
</head>
<body>
<h2>layer功能测试</h2><br/><br/>

<input type="button" id="create" value="创建layer test"/>
<br/>
属性默认值
 {"fx":"slide","reverse":false,"duration":"normal",pullToRefresh:"false"}
<br/>
<hr/>
<input type="button" id="create1" value="设置动画slide"/>
<br/>
动画设置为slide
 {"fx":"slide","reverse":false,"duration":"normal"}
<hr/>
<input type="button" id="create2" value="设置动画pop"/>
<br/>
动画设置为pop
 {"fx":"pop","reverse":false,"duration":"normal"}
<hr/>
<input type="button" id="create3" value="设置动画fade"/>
<br/>
动画设置为fade
 {"fx":"fade","reverse":false,"duration":"normal"}
<hr/>
<input type="button" id="resumeLayer" value="重新激活layer test"/><br/>
重新激活创建的layer test
<br/>
<hr/>
<input type="button" id="reload" value="改变layer test的url"/><br/>
改变layer test的url
<br/>
<hr/>
<input type="button" id="showEvent" value="onshow事件回调"/><br/>
当激活创建的layer时进行回调
<br/>
<hr/>
<input type="button" id="hideEvent" value="onhide事件回调"/><br/>
当隐藏(调back或者返回键回退)时进行回调

<hr/>
<input type="button" id="afterrenderEvent" value="afterrender事件回调"/>
<br/>
当webview创建成功时进行回调
<hr/>
<input type="button" id="onloadEvent" value="onload事件回调"/>
<br/>
页面加载完成进行回调
<hr/>
<input type="button" id="changeUrlEvent" value="changeUrl事件回调"/>
<br/>
页面url改变事件回调
<hr/><!-- <input type="button" id="back" value="返回"/><br/> -->
<input type="button" id="messageEvent" value="不同layer直接进行消息传递"/>
<br/>
监听message
<hr/>
<input type="button" id="selfEvent" value="自定义监听事件，子层可以触发"/>
<br/>
监听baidu事件
<br/>
<input type="button" id="menuP" value="监听菜单键"/>
<br/>
监听菜单事件
<br/>
<input type="button" id="backKey" value="监听返回键"/>
<br/>
监听返回键
<br/>
<input type="button" id="isAvailable" value="isAvailable"/>
<br/>
isAvailable
<br/>
<input type="button" id="isActive" value="isActive"/>
<br/>
isActive
<br/>
<input type="button" id="canGoBack" value="canGoBack"/>
<br/>
canGoback
<br/>
<input type="button" id="layerClearHistory" value="layerClearHistory"/>
<br/>
layerClearHistory
<br/>
<input type="button" id="exitApp" value="exitApp"/>
<br/>
exitApp
</body>
<script>
require.config({
    baseUrl:"../../../"
});
require(['src/hybrid/blend','src/hybrid/Layer'], function ( main,Layer) {
    var _layer;
    var _layer1;
    var layerApi = main.api.layer;
    main.readyState = true;
    var _eval = {
        create : function(){
            _layer1&&_layer1.destroy();
            _layer1 = new Layer({
                'id':"test1",
                "url":"http://fedev.baidu.com/~zhangjianguang/lightapp/usecase/test/layer/index_demo.html",
                "active":true,
                "pullToRefresh":true
            });
        },
        create1 : function(){
            _layer&&_layer.destroy();
            _layer = new Layer({
                'id':"test",
                "url":"http://fedev.baidu.com/~zhangjianguang/lightapp/usecase/test/layer/index_demo.html",
                "active":true,
                "reverse":true,
                "fx":"slide",
                "duration":"quick"
            });
        },
        create2 : function(){
            _layer&&_layer.destroy();
            _layer = new Layer({
                'id':"test",
                "url":"http://fedev.baidu.com/~zhangjianguang/lightapp/usecase/test/layer/index_demo.html",
                "active":true,
                "reverse":false,
                "fx":"pop",
                "duration":"quick"
            });
        },
        create3 : function(){
            _layer&&_layer.destroy();
            _layer = new Layer({
                'id':"test",
                "url":"http://fedev.baidu.com/~zhangjianguang/lightapp/usecase/test/layer/index_demo.html",
                "active":true,
                "reverse":false,
                "fx":"fade",
                "duration":"quick"
            });
        },
        resumeLayer:function(){
            _layer.in()
        },
        reload:function(){
            _layer.reload('http://fedev.baidu.com/~zhangjianguang/lightapp/usecase/test/layer/index_demo.html');
            _layer.in();
            /*setTimeout(function(){
                //alert(222);
                //_layer.replace('http://tieba.baidu.com')
                _layer.in();
                console.log(11111);
            },1000);*/
        },
        back :function(){
            alert('请在test layer上面点击返回按钮测试')
        },
        showEvent:function(){
            _layer&&_layer.destroy();
            _layer = new Layer({
                'id':"test",
                "url":"http://fedev.baidu.com/~zhangjianguang/lightapp/usecase/test/layer/index_demo.html",
                "active":true,
                "onshow":function(){
                    alert("onshow:"+this.id)
                }
            });
        },
        hideEvent:function(){
            _layer&&_layer.destroy();
            _layer = new Layer({
                'id':"test",
                "url":"http://fedev.baidu.com/~zhangjianguang/lightapp/usecase/test/layer/index_demo.html",
                "active":true,
                "onhide":function(){
                    alert("onhide:"+this.id)
                }
            });
        },
        afterrenderEvent:function(){
            _layer&&_layer.destroy();
            _layer = new Layer({
                'id':"test",
                "url":"http://fedev.baidu.com/~zhangjianguang/lightapp/usecase/test/layer/index_demo.html",
                "active":true,
                "afterrender":function(){
                    alert("afterrender:"+this.id)
                }
            });
        },
        onloadEvent:function(){
            _layer&&_layer.destroy();
            _layer = new Layer({
                'id':"test",
                "url":"http://fedev.baidu.com/~zhangjianguang/lightapp/usecase/test/layer/index_demo.html",
                "active":true,
                "onload":function(){
                    alert("onload:"+this.id)
                }
            });
        },
        changeUrlEvent:function(){
            _layer&&_layer.destroy();
            _layer = new Layer({
                'id':"test",
                "url":"http://fedev.baidu.com/~zhangjianguang/lightapp/usecase/test/layer/index_demo.html",
                "active":true,
                "changeUrl":function(e){
                    console.log("changeUrl:"+this.id+"\n"+event['url'])
                    alert("changeUrl:"+this.id+"\n"+event['url'])
                }
            });
        },
        messageEvent:function(){
            layerApi.on('message',function(event){
                alert("接收postMessage 传递的数据为:"+event.data);
            });
            _layer.in();
        },
        selfEvent:function(){
            layerApi.off('baidu',"all");

            layerApi.on('baidu',function(event){
                alert("触发自定义事件baidu:"+event.data.aaa);
                if(event.callback){
                    event.callback({ccc:"http://wwww.gagadfsal.&?;"});
                }
            });

            layerApi.on('book',function(event){
                //alert(event['reciever']);
                //alert(event['sender']);
                //alert(event['origin']);
                alert("触发自定义事件book:"+event.data.aaa);
                if(event.callback){
                    event.callback({ccc:"bbbbb"});
                }
            });

            _layer.in();
        },
        menuP:function(){
            layerApi.on('menuPressed',function(e){
                alert("菜单事件" + e['origin']);
            },"test");
        },
        backKey:function(){
            layerApi.on("layerGoBack",function(){
                alert('test-layer keyBack');
            },'test');

            layerApi.on("layerGoBack",function(){
                alert("0-layer keyBack");
            });
        },
        isAvailable:function(){
            alert(layerApi.isAvailable('test'));
        },
        isActive:function(){
            alert(_layer.isActive());
        },
        canGoBack:function(){
            alert(_layer.canGoBack());
        },
        layerClearHistory:function(){
            _layer.clearHistory();
        },
        exitApp:function(){
            main.api.core.exitApp();
        }
    };
    main.ready(function(){
        _layer = new Layer({
            'id':"test",
            "url":"http://fedev.baidu.com/~zhangjianguang/lightapp/usecase/test/layer/index_demo.html",
            "pullToRefresh":true
            /*"changeUrl":function(e){
                console.log("changeUrl Event:"+ e['origin']);
            },*/
            /*"onload":function(e){
                //alert("onload");
                console.log("onload Event:"+ e['origin']);
            }*/
        });
    });

    $('input[type=button]').click(function(e){
        var id = this.id;
        console.log(id+"=============="+id);
        if(_eval[id]){
            _eval[id].call(_eval);
        }else{
            alert('没有此case')
        }
    });

 
/*document.addEventListener('menuPressed', function(event) {
    console.log('menuPressed origin: ' + event['origin']);
}, false);*/
/*var n = 0;*/
/*document.addEventListener('layerGoBack', function(event) {
    _layer.replace('http://tieba.baidu.com');
    alert('ddd');
    console.log('layerGoBack origin: ' + event['origin']+ " "+ n++);
}, false);*/



/*var dd = 1*new Date();
document.addEventListener('runtimeready', function() {
    window.nuwa_runtime && nuwa_runtime.removeSplashScreen();
    console.log("timetime:" + (1*new Date()-dd));
    //nuwa.pm.bindAk('wTk7LUNhzrRpTYlcRK3Ltk8f');
    //加载所有依赖的插件
    nuwa.pm.absorb('device', function(inst) {
        
        inst.on('error', function(err) {
            console.info('adb_yuedu: device inst error:' + err);
        });

        inst.on('complete', function() {
            console.info("timetime:"+ (1*new Date()-dd));
            
            nuwa.pm.absorb('filetransfer', function(inst) {

                inst.on('error', function(err) {
                    console.info('adb_yuedu: filetransfer inst error:' + err);
                });

                inst.on('complete', function() {
                    console.info("timetime:"+ (1*new Date()-dd));
                    console.info('adb_yuedu: complete');
                    
                    window.plg.filetransfer = nuwa.require('filetransfer');

                    cb && cb();

                });

                inst.on('progress', function(percentage) {
                    console.log('adb_yuedu: filetransfer' + 'percentage = ' + percentage);
                });
            });
            window.plg.device = nuwa.require('device');
        });

        inst.on('progress', function(percentage) {
            console.log('adb_yuedu: device' + 'percentage = ' + percentage);
        });
    });

});*/


});
</script>
<br>
<br>
<br>
<br>
<br>

</html>